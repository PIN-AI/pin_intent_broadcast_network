syntax = "proto3";
package kratos.api;

option go_package = "pin_intent_broadcast_network/internal/conf;conf";

import "google/protobuf/duration.proto";

message Bootstrap {
  Server server = 1;
  Data data = 2;
  P2P p2p = 3;
  Transport transport = 4;
}

message Server {
  message HTTP {
    string network = 1;
    string addr = 2;
    google.protobuf.Duration timeout = 3;
  }
  message GRPC {
    string network = 1;
    string addr = 2;
    google.protobuf.Duration timeout = 3;
  }
  HTTP http = 1;
  GRPC grpc = 2;
}

message Data {
  message Database {
    string driver = 1;
    string source = 2;
  }
  message Redis {
    string network = 1;
    string addr = 2;
    google.protobuf.Duration read_timeout = 3;
    google.protobuf.Duration write_timeout = 4;
  }
  Database database = 1;
  Redis redis = 2;
}

message P2P {
  repeated string listen_addresses = 1;
  repeated string bootstrap_peers = 2;
  string protocol_id = 3;
  bool enable_mdns = 4;
  bool enable_dht = 5;
  string data_dir = 6;
  int32 max_connections = 7;
  bool enable_signing = 8;
}

message Transport {
  bool enable_gossipsub = 1;
  google.protobuf.Duration gossipsub_heartbeat_interval = 2;
  int32 gossipsub_d = 3;
  int32 gossipsub_d_lo = 4;
  int32 gossipsub_d_hi = 5;
  google.protobuf.Duration gossipsub_fanout_ttl = 6;
  bool enable_message_signing = 7;
  bool enable_strict_signature_verification = 8;
  int32 message_id_cache_size = 9;
  google.protobuf.Duration message_ttl = 10;
  int32 max_message_size = 11;
  
  // Intent monitoring configuration
  IntentMonitoring intent_monitoring = 20;
}

// Intent monitoring configuration
message IntentMonitoring {
  // Subscription mode: "wildcard", "explicit", "all", "disabled"
  // Default is "all" - listen to all topics
  string subscription_mode = 1;
  
  // Explicit topic list (used in explicit mode)
  repeated string explicit_topics = 2;
  
  // Wildcard pattern list for topic matching
  repeated string wildcard_patterns = 3;
  
  // Intent filter configuration
  IntentFilter filter = 4;
  
  // Statistics configuration
  StatisticsConfig statistics = 5;
  
  // Performance configuration
  PerformanceConfig performance = 6;
}

// Intent filter configuration
message IntentFilter {
  // Allowed intent types (empty means allow all)
  repeated string allowed_types = 1;
  
  // Blocked intent types
  repeated string blocked_types = 2;
  
  // Sender filter rules
  repeated string allowed_senders = 3;
  repeated string blocked_senders = 4;
  
  // Priority filter
  int32 min_priority = 5;
  int32 max_priority = 6;
}

// Statistics configuration
message StatisticsConfig {
  // Enable statistics collection
  bool enabled = 1;
  
  // Statistics data retention period
  google.protobuf.Duration retention_period = 2;
  
  // Statistics aggregation interval
  google.protobuf.Duration aggregation_interval = 3;
}

// Performance configuration
message PerformanceConfig {
  // Maximum concurrent subscriptions
  int32 max_subscriptions = 1;
  
  // Message processing buffer size
  int32 message_buffer_size = 2;
  
  // Batch processing size
  int32 batch_size = 3;
}
