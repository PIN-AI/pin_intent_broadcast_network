syntax = "proto3";

package api.pinai_intent.v1;

import "google/api/annotations.proto";

option go_package = "github.com/pin-project/pin_intent_broadcast_network/api/pinai_intent/v1;v1";

// Tag represents a data access requirement with fee and tradability information
message Tag {
  string tag_name = 1;      // Name of the data tag (e.g., "shopping_history")
  string tag_fee = 2;       // Access fee in Octa (Aptos native token smallest unit)
  bool is_tradable = 3;     // Whether this tag can be requested by agents
}

// IntentManifest describes the intent task and requirements
message IntentManifest {
  string task = 1;          // Human readable task description
  map<string, string> requirements = 2; // Additional task requirements
  string context = 3;       // Optional context information
}

// Intent status enumeration
enum IntentStatus {
  INTENT_STATUS_UNSPECIFIED = 0;
  INTENT_STATUS_CREATED = 1;
  INTENT_STATUS_VALIDATED = 2;
  INTENT_STATUS_BROADCASTED = 3;
  INTENT_STATUS_PROCESSED = 4;
  INTENT_STATUS_MATCHED = 5;
  INTENT_STATUS_COMPLETED = 6;
  INTENT_STATUS_FAILED = 7;
  INTENT_STATUS_EXPIRED = 8;
}

// Intent message structure
message Intent {
  string id = 1;
  string type = 2;
  bytes payload = 3;
  int64 timestamp = 4;
  string sender_id = 5;
  bytes signature = 6;
  string signature_algorithm = 7;
  map<string, string> metadata = 8;
  IntentStatus status = 9;
  int32 priority = 10;
  int64 ttl = 11;
  int64 processed_at = 12;
  string error = 13;
  string user_address = 14;         // User's Aptos address
  IntentManifest intent_manifest = 15; // Intent description and requirements
  repeated Tag relevant_tags = 16;  // List of required data tags
  int64 max_duration = 17;         // Intent validity duration in seconds
}

// CreateIntent request message
message CreateIntentRequest {
  string type = 1;
  bytes payload = 2;
  string sender_id = 3;
  map<string, string> metadata = 4;
  int32 priority = 5;
  int64 ttl = 6;
  string user_address = 7;         // User's Aptos address
  IntentManifest intent_manifest = 8; // Intent description and requirements
  repeated Tag relevant_tags = 9;  // List of required data tags
  int64 max_duration = 10;        // Intent validity duration in seconds
}

// CreateIntent response message
message CreateIntentResponse {
  Intent intent = 1;
  bool success = 2;
  string message = 3;
}

// BroadcastIntent request message
message BroadcastIntentRequest {
  string intent_id = 1;
  string topic = 2;
}

// BroadcastIntent response message
message BroadcastIntentResponse {
  bool success = 1;
  string intent_id = 2;
  string topic = 3;
  string message = 4;
}

// QueryIntents request message
message QueryIntentsRequest {
  string type = 1;
  IntentStatus status = 2;
  int64 start_time = 3;
  int64 end_time = 4;
  int32 limit = 5;
  int32 offset = 6;
}

// QueryIntents response message
message QueryIntentsResponse {
  repeated Intent intents = 1;
  int32 total = 2;
}

// GetIntentStatus request message
message GetIntentStatusRequest {
  string intent_id = 1;
}

// GetIntentStatus response message
message GetIntentStatusResponse {
  Intent intent = 1;
}

// Intent service definition
service IntentService {
  // Create a new intent
  rpc CreateIntent(CreateIntentRequest) returns (CreateIntentResponse) {
    option (google.api.http) = {
      post: "/pinai_intent/intent/create"
      body: "*"
    };
  }

  // Broadcast an intent
  rpc BroadcastIntent(BroadcastIntentRequest) returns (BroadcastIntentResponse) {
    option (google.api.http) = {
      post: "/pinai_intent/intent/broadcast"
      body: "*"
    };
  }

  // Query intents with filters
  rpc QueryIntents(QueryIntentsRequest) returns (QueryIntentsResponse) {
    option (google.api.http) = {
      get: "/pinai_intent/intent/list"
    };
  }

  // Get intent status by ID
  rpc GetIntentStatus(GetIntentStatusRequest) returns (GetIntentStatusResponse) {
    option (google.api.http) = {
      get: "/pinai_intent/intent/status"
    };
  }
}